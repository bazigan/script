# Ambil semua FileSystemId
FILESYSTEMS=$(aws efs describe-file-systems --query "FileSystems[].FileSystemId" --output text)

if [ -z "$FILESYSTEMS" ]; then
    echo "âœ… Tidak ada EFS ditemukan."
    exit 0
fi

for fs in $FILESYSTEMS; do
    echo "ğŸ” Memproses EFS: $fs"

    # Hapus semua mount target dulu
    MOUNTS=$(aws efs describe-mount-targets --file-system-id "$fs" --query "MountTargets[].MountTargetId" --output text)
    if [ -n "$MOUNTS" ]; then
        for mt in $MOUNTS; do
            echo "  ğŸ—‘ï¸  Menghapus mount target: $mt"
            aws efs delete-mount-target --mount-target-id "$mt"
        done
        echo "  â³ Menunggu semua mount target terhapus..."
        sleep 10
    fi

    # Hapus file system
    echo "ğŸ—‘ï¸  Menghapus filesystem: $fs"
    aws efs delete-file-system --file-system-id "$fs"
    echo "âœ… EFS $fs sudah dihapus."
done

echo "ğŸ¯ Semua EFS sudah dihapus."
